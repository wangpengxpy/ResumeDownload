@{
    ViewData["Title"] = "Home Page";
}

<link href="~/lib/bootstrap/dist/css/bootstrap.css" rel="stylesheet" />

<div class="text-center">
    <h1 class="display-4">断点续传下载</h1>
</div>

<div class="form-horizontal" id="body" style="margin-top:80px;">
</div>

<script src="~/lib/jquery/dist/jquery.js"></script>
<script src="~/lib/bootstrap/dist/js/bootstrap.js"></script>
<script src="~/lib/signalr/signalr.js"></script>
<script src="~/js/progress.js"></script>

<script type="text/javascript">
    // 定义测试文件id
    var files = [{ 'url': 'https://www.hnsdwl.com/mongo.zip', 'id': '0062A0E4847F438087FA0308729B675C' }, { 'url': 'https://www.hnsdwl.com/ubuntu.iso', 'id': '37484F8E2F504169BA6B224EE2C82467'}]
    // 下载
    function download(e) {
        $.ajax({
            url: '/api/download/start?url=' + $(e).data('url') + '&id=' + $(e).data('id'),
            type: "post",
            cache: false,
            contentType: "application/json"
        });
    }
    // 暂停
    function pause(e) {
        $.ajax({
            url: '/api/download/pause?id=' + $(e).data('id'),
            type: "post",
            cache: false,
            contentType: "application/json"
        });
    }
    // 继续
    function continuation(e) {
        $.ajax({
            url: '/api/download/continue?id=' + $(e).data('id'),
            type: "post",
            cache: false,
            contentType: "application/json"
        });
    }
    // 取消
    function cancell(id) {
        $.ajax({
            url: '/api/download/cancell?&id=' + $(e).data('id'),
            type: "post",
            cache: false,
            contentType: "application/json"
        });
    }
    $(function () {
        var html = '';
        for (var i = 0; i < files.length; i++) {
            var file = files[i]
            html += '<div class="form-group" id="progress-group">'
            html +=     '<div id="size' + file.id + '"></div>'
            html +=         '<div class="progress  progress-striped">'
            html +=             '<div id="progress' + file.id + '" class="progress-bar progress-bar-success progress-bar-animated progress-bar-striped" role="progressbar"  aria-valuemin="0" aria-valuemax="100">'
            html +=             '<span id="percentage' + file.id + '""></span>'
            html +=         '</div>'
            html +=     '</div>'
            html += '</div>'
            html += '<div class="form-group">'
            html +=     '<div class="col-md-offset-2 col-md-10">'
            html +=         '<input type="button" data-url='+ file.url +' style="margin-right:15px;" data-id=' + file.id + '  onClick="download(this)" value="下载" class="btn btn-success" />'
            html +=         '<input type="button" data-url='+ file.url+'  style="margin-right:15px;" data-id=' + file.id + '  onClick="pause(this)" value="暂停" class="btn btn-danger" />'
            html +=         '<input type="button" data-url='+ file.url +' style="margin-right:15px;" data-id=' + file.id + '  onClick="continuation(this)" value="继续" class="btn btn-success" />'
            html +=         '<input type="button" data-url='+ file.url +' data-id=' + file.id + '  onClick="cancell(this)" value="取消" class="btn btn-danger" />'
            html +=     '</div>'
            html += '</div>'
        }
        $('#body').html(html)
    });
</script>